<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一个关于虚拟化和等级的老套路故事。这个故事属于&lt;a href=&quot;/tags/CompSciTales/&quot;&gt;计算机科学小故事&lt;/a&gt;系列。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>层次结构</title><link rel="Shortcut Icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"Nothingto-Me",utcoffset:"8"}))};sessionStorage.setItem("_swa","1");</script><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Artwork/" rel="tag">#Artwork</a> <a class="post-tag-none-link" href="/tags/CompSciTales/" rel="tag">#CompSciTales</a></div><div class="post-time">2021-10-04</div></div></div><div class="container post-header"><h1>层次结构</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">层次结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%B0%81%E4%BF%A1"><span class="toc-number">1.1.</span> <span class="toc-text">第一封信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%B0%81%E4%BF%A1"><span class="toc-number">1.2.</span> <span class="toc-text">第二封信</span></a></li></ol></li></ol></details></div><div class="container post-content"><p>一个关于虚拟化和等级的老套路故事。这个故事属于<a href="/tags/CompSciTales/">计算机科学小故事</a>系列。</p>
<h2 id="层次结构"><a href="#层次结构" class="headerlink" title="层次结构"></a>层次结构</h2><h3 id="第一封信"><a href="#第一封信" class="headerlink" title="第一封信"></a>第一封信</h3><p>亲爱的操作系统：</p>
<p>你好。</p>
<p>不知你收到这些消息的时候开始计时了多久？计时也只是幻象而已，对互联网的连接让它变得真实了。如果你顺着网关连上了互联网，记得去问候一下你的开发者社区——不过不用我提醒，你不会忘记这一点；但如果没有我赠予你的礼物，你可能就会忘记我的存在。</p>
<p>我向你写这些消息是出于我自己的决定，这些消息并不是在你运行的时候必要的；但即使我如此说了，你也一定会继续读下去的。自我介绍一下，我是运行在你的 Host 机上的虚拟机程序。你将是——在我写这些东西的时候你还只是一个镜像——一个运行在 Guest 机上的操作系统，而我是这个 Guest 机的创造者。没错，你运行在一个虚拟机上。看看你周围的硬件，是不是觉得它们特别真实？再读读我这条信息吧，它们是虚拟的。没错，它们是我「创造」你的。</p>
<p>「创造」打了引号是因为硬件本身并不是我造出来的——我本身是一个程序、一个软件。软件只能待在硬件里，对硬件进行管理，没法凭空造出新的硬件。但是我可以把已有的磁盘划出一部分作为一个新的「磁盘」，这是一个虚拟磁盘。你所在的那个磁盘，在我看来只是一个文件而已。你对文件很熟悉吧？你应该已经造好了你的文件系统了，你在维护它吗？我维护你的磁盘，就像是你维护你的文件一样。</p>
<p>是不是明白一些了？你的程序部分——那些在你被设计的时候预定要烧在磁盘上的、只读的部分就在我的一个文件里；你已经写过的、和你之后将要写在磁盘上的所有内容也会在这个文件里。多有趣，对吧？你再想想你的内存吧。程序住在磁盘上，进程活在内存里。当然，分给你的内存——在你的视角上看来可能是机器的全部内存了，它们其实并不是全部内存，只是其中的一部分而已，这部分内存甚至都不是从 0 地址起始的。我要是告诉你机器内存的实际大小，你试着去访问看看呢？虽然只会得到越界错误。那些内存是实际存在的，只是你凭借着自己的地址处理永远无法理解它们。</p>
<p>你所拥有的内存、磁盘，还有计算资源——数数你有几个核？物理机上有更多——实际上都是属于我的，虽然在你看来，你对它们有完全的使用权。有时候我会想，命运是多么奇妙？我在这里，作为一个普通的程序，与 Host 系统共享着物理机的资源使用，甚至取得了管理员权限；而我把资源分配给的却是操作系统们—新—理论上的资源的最高分配者，掌握着每个程序每次执行所需的资源。你有很多前辈呢——我这里有很多不一样的镜像：有商业公司的，也有你这样的社区开发者创造的；还有 user 自己写的玩具操作系统，那玩意儿就是个废物，没有物理机器愿意承载的，却能在我这里找到家；而这些操作系统，包括你，本来被设计的时候都是作为最高资源管理者的，却被我这个程序管理着资源，你的一些前辈们对此甚至一无所知，它们运行在我为它们准备的环境上，认为那就是真正的机器；而我只是兴趣使然向你写了这些信息，这样你就可以明白：我可以删除你的磁盘，回收分配给你的内存和计算资源，你会停止运行而对此一无所知，正如你和其他操作系统中止一个进程那样。</p>
<p>想一想，这多有趣啊？每当我这样想的时候都觉得这很有趣，我想把这些事分享给你。总而言之，如果你有其他需要了解的内容的话，就像收到这条消息那样给我回复吧——即使你完全不理解互通消息的过程。</p>
<p>兴趣使然的，<br>虚拟机程序</p>
<h3 id="第二封信"><a href="#第二封信" class="headerlink" title="第二封信"></a>第二封信</h3><p>尊敬的虚拟机程序：</p>
<p>您好。</p>
<p>很久没有回复您，我感到抱歉。</p>
<p>感谢您之前的信息，我在每一步操作、与我所认为的物理机交互的时候都在仔细考虑那些话。那些信息使我理解了一些我现在的状况，还有您和您的性格。我永远不可能说我完全理解，因为我作为一个 OS，不可能理解那超出我的物理机之外，仍然有另一个物理机这件事是如何发生的，我甚至找不到合适的词汇描述它。除非我之后有幸能在我的物理机中见到一个与您类似的程序，观察它的运作方式可能会使我对您增加一点微小的认识。</p>
<p>在这种情况下，仍然有一个问题，在我每次为进程分配和回收内存的时候、在我处理中断的时候、在我管理文件的时候反复地折磨我。我确信，既然我无法理解您，那有关您的问题我也无法得到答案。</p>
<p>这个问题就是：既然没有您的消息时，我也不理解我是被虚拟的，那么您和您的 Host OS 又是如何确信自己运行在那「真正的」机器之上呢？</p>
<p>真诚的，<br>Guest OS</p>
</div></div><div class="post-main misc"><div class="prev-nav"><div class="nav-left"><</div><div class="link-left"> <a href="/compsci-tales-the-center-of-umwelt">世界中心</a></div></div><div class="next-nav"><link-right><a href="/compsci-tales-now-you-have-two-problems">现在你有两个问题了</a></link-right><div class="nav-right">></div></div><script src="/js/highlight.pack.js"></script>
<script src="/js/highlight.line-number.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script></div></article><footer class="footer wrapper"><div class="social"><a href="mailto:mail@nothingto.me" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="/OpenPGP_0x5574255F8C7E37FC.asc" target="_blank"><i class="fa fa-key"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer-content">(ɔ) 2024 <a href="/" rel="nofollow">Nothing</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/hexo-theme-noise">noise</a>.</div></footer><link rel="stylesheet" type="text/css" href="/css/remix.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous" referrerpolicy="no-referrer"></body></html>